<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>iCore Encoder</title>
  <script>
        window.ic_settings = [ic_SETTINGS];
        window.ic_properties = [ic_PROPERTIES];

    function getProperties() {
        let prop = window.ic_properties;
        if (typeof prop === 'object') {
         return prop
     } else {
          return
     }
    }

    function setProperties(p) {
        window.ic_properties = p;
    }
    </script>

    <ic_style>

</head>
<body onLoad=setQRCode();>

    <DIV id="qrDisplay" style="display:flex;justify-content:center;" ></DIV>

    <script>

        function setQRCode(){
            var prop = getProperties();
            if (prop != null) {
                var qrCode = qrcode( prop.typeNumber, prop.errorCorrection );
                qrCode.addData(prop.text);
                qrCode.make();
                columns=qrCode.getModuleCount();

                var size=Math.floor( prop.size / (columns+( prop.margin == 1 ? 8 : 0 )));
                margin = prop.margin == 1 ? 4*size : 0;
                var img=qrCode.createImgTag(size, margin, prop.text);

                document.getElementById("qrDisplay").innerHTML = img
            }
        }

        function getQRCode(AddOn){
            img=document.getElementById("qrDisplay").innerHTML;
            result={[window.ic_settings.AddOn]:{"img":img}};
            FileMaker.PerformScriptWithOption( window.ic_settings.script , JSON.stringify( result ), "5")
        }
    </script>

    <ic_script>

</body>
</html>